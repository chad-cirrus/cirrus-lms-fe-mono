<div class="breadcrumb-container">
  <div class="breadcrumb-item-container" (click)="navigateToCoursesOrCatalog()">
    <img src="courses/images/svg/chevron-left-white.svg" />
    <div class="title">{{ breadcrumbsTitle }}</div>
  </div>
</div>

<div class="lesson-image" [ngStyle]="background$ | async">
  <h1>{{ course.title }}</h1>
  <mat-divider></mat-divider>
  <div class="course-sub-title" *ngIf="course.subtitle">
    <p class="large">{{ course.subtitle }}</p>
  </div>

  <div class="course-stats-wrapper" *ngIf="!course.course_attempt?.id && course.course_content_stats.length">
    <ul class="course-stats">

      <ng-container *ngFor="let stat of course.course_content_stats">
        <li class="course-stat" *ngIf="stat.total > 0">
          <div class="icon" [ngSwitch]="stat.type">

            <svg *ngSwitchCase="'self_study'" width="23" height="27" viewBox="0 0 23 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_11240_30262)">
                <path d="M3.01263 0.568601C2.67788 0.563722 2.34616 0.63268 2.04109 0.770568C1.73601 0.908457 1.46508 1.11189 1.24756 1.36638C1.03004 1.62088 0.871283 1.92019 0.782584 2.24302C0.693886 2.56584 0.677426 2.90425 0.734376 3.23416C0.84495 3.78356 1.14758 4.27561 1.58803 4.62212C2.02848 4.96864 2.57794 5.14695 3.13793 5.12511H21.2386C21.5408 5.12511 21.8305 5.24512 22.0441 5.45875C22.2578 5.67238 22.3778 5.96212 22.3778 6.26423V24.4903C22.3778 24.7924 22.2578 25.0821 22.0441 25.2957C21.8305 25.5094 21.5408 25.6294 21.2386 25.6294H3.01263C2.4084 25.6294 1.82892 25.3893 1.40166 24.9621C0.974405 24.5348 0.734376 23.9554 0.734376 23.3511V2.84685C0.734376 2.24262 0.974405 1.66314 1.40166 1.23589C1.82892 0.808631 2.4084 0.568601 3.01263 0.568601H18.9604C19.2625 0.568601 19.5523 0.688616 19.7659 0.902244C19.9795 1.11587 20.0995 1.40561 20.0995 1.70773V5.12511" stroke="#CCCCCC" stroke-width="0.8" stroke-miterlimit="10" stroke-linecap="square"/>
                <path d="M11.5587 15.1272C13.207 15.1272 14.5432 13.791 14.5432 12.1427C14.5432 10.4944 13.207 9.1582 11.5587 9.1582C9.91043 9.1582 8.57422 10.4944 8.57422 12.1427C8.57422 13.791 9.91043 15.1272 11.5587 15.1272Z" stroke="#CCCCCC" stroke-width="0.8" stroke-miterlimit="10"/>
                <path d="M17.5259 22.215C17.5259 19.5152 14.8604 17.3281 11.5569 17.3281C8.25345 17.3281 5.58789 19.5152 5.58789 22.215H17.5259Z" stroke="#CCCCCC" stroke-width="0.8" stroke-miterlimit="10"/>
                <path d="M4.15234 2.84766H20.1001" stroke="#CCCCCC" stroke-width="0.8" stroke-miterlimit="10"/>
                </g>
                <defs>
                <clipPath id="clip0_11240_30262">
                <rect width="22.7825" height="26.1999" fill="white" transform="translate(0.166016)"/>
                </clipPath>
                </defs>
            </svg>
  
            <svg *ngSwitchCase="'ground_assessment'" width="38" height="27" viewBox="0 0 38 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.1112 6.53125H16.5072C17.0095 6.53125 17.5921 6.70312 17.9853 7.26466L25.1876 15.6485H33.9182C34.7041 15.6485 35.477 15.9634 36.0831 16.5681L36.824 17.3074C37.583 18.0646 37.5212 19.1661 36.8696 19.9788L36.8482 20.0054L35.9596 20.892C35.3535 21.4968 34.5806 21.8116 33.7948 21.8116H5.76417C4.38721 21.8116 3.141 20.8967 2.82 19.5009L0.619141 11.9523H4.24195L6.7116 15.6485H16.421L11.1112 6.53125ZM13.2593 7.76608L18.5691 16.8834H6.05157L3.58191 13.1872H2.26541L4.01631 19.1924L4.02064 19.2119C4.20112 20.0222 4.92519 20.5768 5.76417 20.5768H33.7948C34.2437 20.5768 34.7057 20.3988 35.0874 20.0179L35.9255 19.1817C36.24 18.7722 36.1762 18.4054 35.9518 18.1815L35.2109 17.4423C34.8292 17.0614 34.3672 16.8834 33.9182 16.8834H24.6204L17.0024 8.01552L16.9817 7.9845C16.8809 7.83375 16.7358 7.76608 16.5072 7.76608H13.2593Z" fill="#C4C4C4"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M26.1911 3.24942C24.0411 3.31869 22.2643 4.40614 21.0994 6.00771C20.9494 6.214 20.6605 6.25959 20.4543 6.10955C20.248 5.95952 20.2024 5.67066 20.3524 5.46437C21.6656 3.65893 23.695 2.40563 26.1613 2.32617C30.2016 2.19598 33.6551 5.43391 33.7853 9.47419C33.8263 10.7447 33.5714 11.9469 33.0004 12.972C32.8762 13.1948 32.595 13.2748 32.3721 13.1507C32.1493 13.0266 32.0693 12.7453 32.1934 12.5225C32.6708 11.6654 32.8985 10.6339 32.8621 9.50394C32.7483 5.97356 29.7214 3.13567 26.1911 3.24942Z" fill="#C4C4C4"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M26.7429 6.00661C26.9978 5.9984 27.2112 6.19841 27.2194 6.45336L27.3304 9.89931L29.9497 11.5262C30.1664 11.6607 30.2329 11.9455 30.0983 12.1622C29.9638 12.3789 29.679 12.4454 29.4623 12.3108L26.6331 10.5536C26.5019 10.4721 26.4201 10.3305 26.4151 10.1761L26.2961 6.48311C26.2879 6.22816 26.4879 6.01482 26.7429 6.00661Z" fill="#C4C4C4"/>
                <path d="M0.207031 26H37.2519" stroke="#C4C4C4" stroke-miterlimit="10"/>
            </svg>
  
  
            <svg *ngSwitchCase="'flight_assessment'" width="22" height="26" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_11240_31211)">
                <path d="M0.771484 8.4775H8.68453V0.564453" stroke="#CCCCCC" stroke-miterlimit="10"/>
                <path d="M0.771484 23.1731C0.771484 23.7728 1.00968 24.3478 1.43368 24.7718C1.85767 25.1958 2.43273 25.434 3.03235 25.434H18.8584C19.4581 25.434 20.0331 25.1958 20.4571 24.7718C20.8811 24.3478 21.1193 23.7728 21.1193 23.1731V2.82532C21.1193 2.2257 20.8811 1.65064 20.4571 1.22665C20.0331 0.802651 19.4581 0.564453 18.8584 0.564453H8.68453L0.771484 8.4775V23.1731Z" stroke="#CCCCCC" stroke-miterlimit="10"/>
                <path d="M10.3809 20.3477H18.2939" stroke="#CCCCCC" stroke-miterlimit="10"/>
                <path d="M10.3809 13.5645H18.2939" stroke="#CCCCCC" stroke-miterlimit="10"/>
                <path d="M7.55537 11.8691H4.16406V15.2604H7.55537V11.8691Z" stroke="#CCCCCC" stroke-miterlimit="10"/>
                <path d="M7.55537 18.6523H4.16406V22.0436H7.55537V18.6523Z" stroke="#CCCCCC" stroke-miterlimit="10"/>
                </g>
                <defs>
                <clipPath id="clip0_11240_31211">
                <rect width="21.4783" height="26" fill="white" transform="translate(0.207031)"/>
                </clipPath>
                </defs>
            </svg>
  
          </div>
          <div class="course-stat-title">{{ stat.type | convertToSpaces: '_' | titlecase }}</div>
          <div class="course-stat-value">{{ stat.total }}</div>
        </li>
      </ng-container>
      
    </ul>
  </div>
  
  <div *ngIf="course.course_attempt?.id; else coursePreview" class="course-started">
    <cirrus-course-progress
      *ngIf="
        course.progress.status !== PROGRESS_STATUS.completed;
        else completedCourse
      "
      [completed_at]="course.completed_at"
      [lessonStats]="course.lessons_stats"
    ></cirrus-course-progress>

    <cirrus-course-player
      *ngIf="
        course.progress.status !== PROGRESS_STATUS.completed;
        else downloadDocument
      "
      [config]="coursePlayerConfig"
      (ctaAction)="navigateToNextLesson()"
    >
    </cirrus-course-player>

    <ng-template #completedCourse>
      <div class="completed-course-announcement">
        <p fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
          <mat-icon svgIcon="completed"></mat-icon>
          <span
            *ngIf="course?.completed_at && course.completed_at.length > 0"
            class="congrats-text"
          >
            Congrats! You've completed this course as of
            {{ course.completed_at | date : 'MM/dd/yy' }}
          </span>
        </p>
      </div>
    </ng-template>

    <ng-template #downloadDocument>
      <div class="download-document">
        <div
          class="download-button"
          fxLayout="row"
          fxLayoutAlign="start center"
          (click)="downloadCert()"
          *ngIf="course.certificate.id"
        >
          <div *ngIf="certificateLoading$ | async; else value">
            <mat-spinner class="spinner-white" [diameter]="35"></mat-spinner>
          </div>
          <ng-template #value>
            <mat-icon
              class="download_arrow"
              svgIcon="download_arrow"
            ></mat-icon>
          </ng-template>
          <span class="download">Download Certificate</span>
        </div>

        <div
          class="download-button"
          fxLayout="row"
          fxLayoutAlign="start center"
          (click)="downloadTranscript()"
        >
          <div *ngIf="transcriptLoading$ | async; else value1">
            <mat-spinner class="spinner-white" [diameter]="35"></mat-spinner>
          </div>
          <ng-template #value1>
            <mat-icon
              class="download_arrow"
              svgIcon="download_arrow"
            ></mat-icon>
          </ng-template>
          <span class="download">Download Transcript</span>
        </div>
      </div>
      <div class="re-enroll" *ngIf="course.can_reenroll">
        <cirrus-cta-button
          (click)="reEnroll()"
          class="cta-btn"
          [text]="'Re-Enroll'"
          icon="re-enroll"
        ></cirrus-cta-button>
      </div>
    </ng-template>
  </div>
</div>

<ng-template #coursePreview>
  <div class="course-preview-container" #coursePlayer>
    <cirrus-course-player
      [config]="coursePlayerConfig"
      (ctaAction)="enroll()"
      (watchPreview)="watchPreview()"
      [ngClass]="{'sticky' : isSticky}"
    ></cirrus-course-player>
  </div>

  <div class="mobile-preview-video">
    <iframe
      [src]="previewVideoUrl$ | async"
      width="640"
      height="360"
      frameborder="0"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen
      *ngIf="(previewVideoUrl$ | async) !== null"
    ></iframe>
  </div>
</ng-template>
