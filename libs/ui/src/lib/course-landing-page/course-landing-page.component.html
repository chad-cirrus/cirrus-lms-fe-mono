<div class="breadcrumb-container">
  <div class="breadcrumb-item-container" (click)="navigateToCoursesOrCatalog()">
    <img src="courses/images/svg/chevron-left-white.svg" />
    <div class="title">{{ breadcrumbsTitle }}</div>
  </div>
</div>

<div class="lesson-hero" [ngClass]="course.course_attempt?.id ? 'course-state-started' : 'course-state-preview'">
  <div class="lesson-hero-image">
    <div
      class="lesson-hero-image-overlay"
      style="
        background: linear-gradient(90deg, rgba(0, 0, 0, 0.65) 0%, rgba(0, 0, 0, 0.33) 44.11%, rgba(0, 0, 0, 0) 61.94%)
            0% 0% / cover,
          linear-gradient(360deg, rgb(0, 0, 0) 1.79%, rgba(0, 0, 0, 0.24) 19.37%, rgba(0, 0, 0, 0) 25%);
      "
    ></div>
    <img *ngIf="background$ | async as backgroundImage" [src]="backgroundImage" alt="Descriptive text for the image" />
  </div>

  <div class="lesson-hero-content">
    <h1>{{ course.title }}</h1>
    <mat-divider></mat-divider>

    <div class="course-sub-title" *ngIf="course.subtitle">
      <p class="large">{{ course.subtitle }}</p>
    </div>

    <div
      *ngIf="course.course_attempt?.id && course.course_overview_video"
      class="watch-course-intro"
      (click)="watchPreview()"
    >
      <img class="play-logo" src="courses/images/svg/play-logo.svg" />
      <p>Watch Course Intro</p>
    </div>

    <!-- STATE: Course NOT Started AND HAS Course Content Stats -->
    <div class="course-stats-wrapper" *ngIf="!course.course_attempt?.id && filtered_course_content_stats.length">
      <ul class="course-stats">
        <ng-container *ngFor="let stat of filtered_course_content_stats">
          <li class="course-stat" *ngIf="stat.total > 0">
            <div class="icon" [ngSwitch]="stat.type">
              <svg
                *ngSwitchCase="'self_study'"
                width="23"
                height="27"
                viewBox="0 0 23 27"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_11240_30262)">
                  <path
                    d="M3.01263 0.568601C2.67788 0.563722 2.34616 0.63268 2.04109 0.770568C1.73601 0.908457 1.46508 1.11189 1.24756 1.36638C1.03004 1.62088 0.871283 1.92019 0.782584 2.24302C0.693886 2.56584 0.677426 2.90425 0.734376 3.23416C0.84495 3.78356 1.14758 4.27561 1.58803 4.62212C2.02848 4.96864 2.57794 5.14695 3.13793 5.12511H21.2386C21.5408 5.12511 21.8305 5.24512 22.0441 5.45875C22.2578 5.67238 22.3778 5.96212 22.3778 6.26423V24.4903C22.3778 24.7924 22.2578 25.0821 22.0441 25.2957C21.8305 25.5094 21.5408 25.6294 21.2386 25.6294H3.01263C2.4084 25.6294 1.82892 25.3893 1.40166 24.9621C0.974405 24.5348 0.734376 23.9554 0.734376 23.3511V2.84685C0.734376 2.24262 0.974405 1.66314 1.40166 1.23589C1.82892 0.808631 2.4084 0.568601 3.01263 0.568601H18.9604C19.2625 0.568601 19.5523 0.688616 19.7659 0.902244C19.9795 1.11587 20.0995 1.40561 20.0995 1.70773V5.12511"
                    stroke="#CCCCCC"
                    stroke-width="0.8"
                    stroke-miterlimit="10"
                    stroke-linecap="square"
                  />
                  <path
                    d="M11.5587 15.1272C13.207 15.1272 14.5432 13.791 14.5432 12.1427C14.5432 10.4944 13.207 9.1582 11.5587 9.1582C9.91043 9.1582 8.57422 10.4944 8.57422 12.1427C8.57422 13.791 9.91043 15.1272 11.5587 15.1272Z"
                    stroke="#CCCCCC"
                    stroke-width="0.8"
                    stroke-miterlimit="10"
                  />
                  <path
                    d="M17.5259 22.215C17.5259 19.5152 14.8604 17.3281 11.5569 17.3281C8.25345 17.3281 5.58789 19.5152 5.58789 22.215H17.5259Z"
                    stroke="#CCCCCC"
                    stroke-width="0.8"
                    stroke-miterlimit="10"
                  />
                  <path d="M4.15234 2.84766H20.1001" stroke="#CCCCCC" stroke-width="0.8" stroke-miterlimit="10" />
                </g>
                <defs>
                  <clipPath id="clip0_11240_30262">
                    <rect width="22.7825" height="26.1999" fill="white" transform="translate(0.166016)" />
                  </clipPath>
                </defs>
              </svg>

              <svg
                *ngSwitchCase="'ground_assessment'"
                width="56"
                height="27"
                viewBox="0 0 56 27"
                xmlns="http://www.w3.org/2000/svg"
              >
                <defs>
                  <style>
                    .cls-1 {
                      fill: #c4c4c4;
                      stroke-width: 0px;
                    }
                  </style>
                </defs>
                <g id="Layer_1-2">
                  <path
                    class="cls-1"
                    d="m13.73.64c.32,0,.62,0,.86.02,1.06.06,1.63.83,2.47,1.79.24.27,1.63,1.81,2.96,3.35.03.03.07.05.11.05.01,0,.02,0,.03,0,.14-.03.28-.06.43-.1,1.71-.38,3.13-.51,4.27-.51,1.68,0,2.76.29,3.32.51.87.35,2.86,1.61,3.14,1.79.02.01.05.02.07.02,2.61,0,5.49.87,6.86,1.33.34.11.38.59.06.76-.82.44-1.79.78-1.94.83-.01,0-.03.01-.04.02l-.57.42c-.44.33-1.64.65-2.23.8-.12.03-.15.19-.04.26.66.44,1.9,1.52,2.33,1.7.7.29,1.17.55,1.24,1.23.05.5-.53.89-.67.98-.02.01-.04.03-.05.05-.22.37-.52.5-.81.5-.39,0-.76-.24-.91-.48-.02-.03-.05-.06-.09-.07-.38-.1-1.25-.29-1.51-.38-.08-.03-.12-.13-.08-.21l.19-.36s.04-.06.08-.07l1.47-.42c.11-.04.13-.2.03-.26l-2.96-2.19s-.05-.02-.07-.02c0,0,0,0,0,0l-5.83.3c-.07,0-.13.06-.13.14l-.09,1.83c0,.07.04.13.1.15.19.06.58.22.68.64.17.73-.56,1-.73,1.05-.02,0-.04.02-.06.04-.27.3-.53.4-.76.4-.4,0-.69-.3-.78-.4-.02-.02-.04-.03-.06-.04l-1.33-.45c-.06-.02-.1-.08-.1-.14v-.41c0-.07.04-.12.1-.14l1.76-.52c.06-.02.1-.07.1-.13l.07-1.81c0-.08-.05-.14-.13-.15-1.45-.15-13.93-1.25-17.23-1.61-1.88-.21-2.43-1.18-2.79-2.37-.23-.76-1.18-3.96-1.29-4.85-.01-.09.06-.16.15-.16.23,0,.43,0,.62,0,1.58,0,1.82.23,2.5,1.36.37.61,1.62,2.42,2.38,2.99.41.3,1.17.39,2.06.39.76,0,1.61-.06,2.4-.1.44-.02.87-.05,1.31-.13.09-.02.14-.12.1-.2-.87-2-2.76-5.87-3.17-6.72-.04-.09.02-.2.12-.21.41-.02,1.3-.05,2.1-.05m0-.64c-.78,0-1.67.03-2.12.05-.26.01-.5.15-.64.38-.14.23-.15.51-.04.75l.33.69c.61,1.26,1.81,3.72,2.56,5.41-.19.02-.38.03-.59.04l-.64.03c-.58.03-1.19.07-1.73.07-1.09,0-1.52-.14-1.68-.26-.61-.45-1.78-2.08-2.21-2.8-.8-1.34-1.25-1.67-3.05-1.67-.19,0-.4,0-.63,0-.23,0-.44.11-.59.28-.14.17-.21.39-.18.61.14,1.07,1.31,4.91,1.32,4.95.4,1.32,1.09,2.57,3.34,2.82,2.22.24,8.66.83,12.93,1.22,1.69.15,3.08.28,3.84.35l-.04.99-1.42.42c-.33.09-.56.41-.56.76v.41c0,.34.21.64.53.75l1.22.41c.21.21.62.52,1.16.52.29,0,.72-.09,1.14-.51.68-.26,1.24-.89,1.03-1.77-.1-.41-.36-.74-.75-.95l.05-1.03,5.2-.27,2.01,1.48-.49.14c-.22.08-.37.21-.47.38l-.19.37c-.11.2-.12.43-.04.65.08.21.25.38.46.46.2.07.61.17,1.17.31l.22.05c.31.36.83.61,1.33.61.52,0,.98-.25,1.29-.71.31-.21.96-.74.88-1.53-.11-1.11-1.02-1.5-1.62-1.76-.17-.07-.76-.53-1.15-.84-.08-.06-.16-.12-.24-.19.69-.21,1.18-.42,1.46-.63l.51-.38c.31-.11,1.19-.44,1.96-.85.37-.2.59-.6.55-1.02-.03-.42-.31-.78-.71-.91-1.46-.5-4.28-1.32-6.92-1.36-.56-.36-2.28-1.43-3.13-1.76-.52-.21-1.68-.56-3.56-.56-1.34,0-2.82.18-4.41.53l-.14.03c-.99-1.14-1.98-2.25-2.47-2.8l-.3-.33-.22-.26c-.75-.86-1.46-1.68-2.69-1.75-.25-.01-.57-.02-.9-.02h0Z"
                  />
                  <path
                    class="cls-1"
                    d="m40.84,19.41H.32c-.18,0-.32-.14-.32-.32s.14-.32.32-.32h40.52c.18,0,.32.14.32.32s-.14.32-.32.32Z"
                  />
                </g>
              </svg>

              <svg
                *ngSwitchCase="'flight_assessment'"
                width="37"
                height="27"
                viewBox="0 0 37 27"
                xmlns="http://www.w3.org/2000/svg"
              >
                <defs>
                  <style>
                    .cls-1 {
                      fill: #c4c4c4;
                      stroke-width: 0px;
                    }
                  </style>
                </defs>
                <g id="Layer_1-2">
                  <path
                    class="cls-1"
                    d="m.32,27.12c-.09,0-.17-.04-.24-.1-.12-.13-.11-.33.02-.45.06-.06,6.59-5.9,18.43-5.9s18,5.84,18.06,5.9c.13.12.13.33.01.45-.12.13-.33.13-.45.01-.06-.06-6.23-5.73-17.62-5.73S.6,26.98.54,27.04c-.06.06-.14.08-.22.08Z"
                  />
                  <path
                    class="cls-1"
                    d="m11.44.64c.32,0,.62,0,.86.02,1.06.06,1.63.83,2.47,1.79.24.27,1.63,1.81,2.96,3.35.03.03.07.05.11.05.01,0,.02,0,.03,0,.14-.03.28-.06.43-.1,1.71-.38,3.13-.51,4.27-.51,1.68,0,2.76.29,3.32.51.87.35,2.86,1.61,3.14,1.79.02.01.05.02.07.02,2.61,0,5.49.87,6.86,1.33.34.11.38.59.06.76-.82.44-1.79.78-1.94.83-.01,0-.03.01-.04.02l-.57.42c-.44.33-1.64.65-2.23.8-.12.03-.15.19-.04.26.66.44,1.9,1.52,2.33,1.7.7.3,1.17.55,1.24,1.23.05.5-.53.89-.67.98-.02.01-.04.03-.05.05-.22.37-.52.5-.81.5-.39,0-.76-.24-.91-.48-.02-.03-.05-.06-.09-.07-.38-.1-1.25-.29-1.5-.38-.08-.03-.12-.13-.08-.2l.19-.36s.05-.06.08-.07l1.47-.42c.11-.04.13-.2.03-.26l-2.96-2.19s-.05-.02-.07-.02c0,0,0,0,0,0l-5.83.3c-.07,0-.13.06-.14.14l-.09,1.83c0,.07.04.13.1.15.19.06.58.22.68.64.17.73-.56,1-.73,1.05-.02,0-.04.02-.06.04-.27.3-.53.4-.76.4-.4,0-.69-.3-.78-.4-.02-.02-.04-.03-.06-.04l-1.33-.45c-.06-.02-.1-.08-.1-.14v-.41c0-.07.04-.12.1-.14l1.76-.52c.06-.02.1-.07.1-.13l.07-1.81c0-.08-.05-.14-.13-.15-1.45-.15-13.93-1.25-17.23-1.61-1.88-.21-2.43-1.18-2.79-2.37-.23-.76-1.18-3.96-1.29-4.85-.01-.09.06-.16.15-.16.23,0,.43,0,.62,0,1.58,0,1.82.23,2.5,1.36.37.61,1.62,2.42,2.38,2.99.41.3,1.17.39,2.06.39.76,0,1.61-.06,2.4-.1.44-.02.87-.05,1.31-.13.09-.02.14-.12.1-.2-.87-2-2.76-5.87-3.17-6.72-.04-.09.02-.2.12-.21.4-.02,1.3-.05,2.09-.05m0-.64c-.82,0-1.76.04-2.12.05-.26.01-.5.15-.64.38-.14.23-.15.51-.04.75l.34.69c.61,1.26,1.8,3.71,2.56,5.4-.19.02-.38.03-.59.04l-.64.03c-.58.03-1.19.07-1.73.07-1.09,0-1.51-.14-1.68-.26-.61-.45-1.78-2.08-2.21-2.8-.8-1.34-1.25-1.67-3.05-1.67-.19,0-.4,0-.64,0-.23,0-.44.11-.59.28-.15.17-.21.4-.18.62.14,1.06,1.3,4.91,1.32,4.94.4,1.32,1.09,2.57,3.34,2.82,2.21.24,8.38.8,12.88,1.21,1.71.15,3.12.28,3.88.35l-.04.99-1.42.42c-.33.09-.56.4-.56.76v.41c0,.34.21.64.53.75l1.22.41c.2.2.61.52,1.17.52.29,0,.72-.09,1.14-.51.68-.26,1.24-.89,1.03-1.76-.1-.41-.36-.74-.75-.95l.05-1.03,5.2-.27,2.01,1.48-.49.14c-.22.08-.38.21-.47.38l-.2.37c-.11.2-.12.44-.04.65.08.21.25.38.46.45.2.07.61.17,1.17.3l.23.06c.31.36.83.61,1.32.61.52,0,.98-.25,1.29-.71.3-.2.96-.73.88-1.53-.11-1.11-1.02-1.5-1.62-1.76-.17-.07-.76-.53-1.15-.84-.08-.06-.16-.12-.24-.19.69-.21,1.18-.42,1.46-.63l.51-.38c.31-.11,1.19-.44,1.96-.85.37-.2.59-.6.55-1.02-.03-.42-.31-.78-.71-.91-1.47-.5-4.29-1.32-6.92-1.36-.56-.36-2.28-1.43-3.13-1.76-.52-.21-1.68-.56-3.56-.56-1.34,0-2.82.18-4.41.53l-.14.03c-.99-1.15-1.99-2.26-2.48-2.81l-.29-.32-.22-.25C14.28.91,13.57.09,12.34.02c-.26-.01-.57-.02-.9-.02h0Z"
                  />
                </g>
              </svg>
            </div>
            <div class="course-stat-title">{{ stat.type | convertToSpaces : '_' | titlecase }}</div>
            <div class="course-stat-value">{{ stat.total }}</div>
          </li>
        </ng-container>
      </ul>
    </div>

    <!-- STATE: Course NOT Started -->
    <div *ngIf="!course.course_attempt?.id">
      <div class="course-preview-container" #coursePlayer>
        <cirrus-course-player
          [config]="coursePlayerConfig"
          (ctaAction)="enroll()"
          (watchPreview)="watchPreview()"
          [ngClass]="{ sticky: isSticky }"
        ></cirrus-course-player>
      </div>

      <div class="mobile-preview-video">
        <iframe
          [src]="previewVideoUrl$ | async"
          width="640"
          height="360"
          frameborder="0"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          *ngIf="(previewVideoUrl$ | async) !== null"
        ></iframe>
      </div>
    </div>

    <!-- STATE: Course Started / Complete -->
    <div *ngIf="course.course_attempt?.id" class="course-started">
      <cirrus-course-progress
        *ngIf="course.progress.status !== PROGRESS_STATUS.completed; else completedCourse"
        [completed_at]="course.completed_at"
        [lessonStats]="course.lessons_stats"
        [certificateStats]="course.certificate_stats"
      ></cirrus-course-progress>

      <ng-template #completedCourse>
        <div class="completed-course-announcement">
          <p fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
            <mat-icon svgIcon="completed"></mat-icon>
            <span *ngIf="course?.completed_at && course.completed_at.length > 0" class="congrats-text">
              Congrats! You've completed this course as of
              {{ course.completed_at | date : 'MM/dd/yy' }}
            </span>
          </p>
        </div>
      </ng-template>

      <cirrus-course-player
        *ngIf="course.progress.status !== PROGRESS_STATUS.completed; else downloadDocument"
        [config]="coursePlayerConfig"
        (ctaAction)="navigateToNextLesson()"
      >
      </cirrus-course-player>

      <ng-template #downloadDocument>
        <div class="download-document">
          <div
            class="download-button"
            fxLayout="row"
            fxLayoutAlign="start center"
            (click)="downloadCert()"
            *ngIf="course?.certificate?.id"
          >
            <div *ngIf="certificateLoading$ | async; else value">
              <mat-spinner class="spinner-white" [diameter]="35"></mat-spinner>
            </div>
            <ng-template #value>
              <mat-icon class="download_arrow" svgIcon="download_arrow"></mat-icon>
            </ng-template>
            <span class="download">Download Certificate</span>
          </div>

          <div class="download-button" fxLayout="row" fxLayoutAlign="start center" (click)="downloadTranscript()">
            <div *ngIf="transcriptLoading$ | async; else value1">
              <mat-spinner class="spinner-white" [diameter]="35"></mat-spinner>
            </div>
            <ng-template #value1>
              <mat-icon class="download_arrow" svgIcon="download_arrow"></mat-icon>
            </ng-template>
            <span class="download">Download Transcript</span>
          </div>
        </div>
        <div class="re-enroll" *ngIf="course.can_reenroll">
          <cirrus-cta-button
            (click)="reEnroll()"
            class="cta-btn"
            [text]="'Re-Enroll'"
            icon="re-enroll"
          ></cirrus-cta-button>
        </div>
      </ng-template>
    </div>
  </div>
</div>
